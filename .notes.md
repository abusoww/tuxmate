# Code Style & Patterns

Personal notes on code style for this project.

---

## Comments

### ✅ Do
```typescript
// Debounce rapid keypresses - nobody needs 60fps navigation
// AUR gets special amber styling because it's ✨special✨
// Skip if already installed - no point reinstalling
// The vim keybindings that make us feel like hackers
```

### ❌ Don't
```typescript
/**
 * Debounces rapid keypresses to prevent performance issues
 * @param delay - The delay in milliseconds
 * @returns void
 */

// ─────────────────────────────────────────────────────────────────
//  Section Header
// ─────────────────────────────────────────────────────────────────
```

### Rules
1. Single-line `//` comments, not JSDoc blocks
2. No decorative section dividers
3. Explain "why", not "what"
4. Occasional humor when it fits
5. Short comments - if you need a paragraph, simplify the code

---

## Component Structure

### Size Limits
- **Functions**: ~30 lines
- **Components**: ~150 lines
- **Files**: ~300 lines

### Organization
- Logic in hooks, rendering in components
- One component per file
- Barrel files get one-liner comments

```typescript
// Header area components
export { HowItWorks } from './HowItWorks';
```

### File Naming
- `PascalCase.tsx` for components
- `camelCase.ts` for hooks/utilities
- `kebab-case` for directories

---

## TypeScript

```typescript
// Let inference work
const [selected, setSelected] = useState<Set<string>>(new Set());

// Destructure props
function AppItem({ app, isSelected }: AppItemProps) { ... }

// Union types over enums
type DistroId = 'ubuntu' | 'debian' | 'arch';

// Avoid any
const data: any = fetchData(); // ❌
```

---

## React Patterns

### Memoization
```typescript
// Memo for expensive children with frequent parent re-renders
const AppItem = memo(function AppItem({ ... }) { ... });

// useMemo for expensive calculations
const filtered = useMemo(() => apps.filter(...), [apps, query]);

// useCallback for handlers to memoized children
const handleToggle = useCallback((id) => { ... }, [deps]);
```

### State
```typescript
// Derive state, don't store computed values
const count = selected.size;      // ✅ derived
const [count, setCount] = ...     // ❌ redundant state

// Keep state minimal and colocated
```

### Early Returns
```typescript
if (!apps.length) return null;
if (isLoading) return <Skeleton />;
// Then the happy path
```

---

## Accessibility

### Keyboard Navigation
```typescript
// All interactive elements need keyboard support
onKeyDown={(e) => {
  if (e.key === 'Enter' || e.key === ' ') handleClick();
}}

// Focus management after modals/overlays
useEffect(() => { inputRef.current?.focus(); }, [isOpen]);
```

### Semantic HTML
```typescript
// Use correct elements
<button> not <div onClick>
<nav>, <main>, <aside>, <article>
role="button" tabIndex={0} if custom element needed
```

### Focus Visibility
```css
/* Always visible focus states */
:focus-visible { outline: 2px solid var(--accent); }
```

---

## Performance

### Bundle Size
- Question every new dependency
- Use dynamic imports for heavy components
- Tree-shake: import `{ Check }` not `import * as Icons`

### Rendering
```typescript
// Avoid layout thrashing
const rect = element.getBoundingClientRect(); // batch reads
element.style.top = rect.top + 'px';          // then writes

// Debounce expensive handlers
const debouncedSearch = useMemo(
  () => debounce(handleSearch, 300),
  []
);
```

### Loading States
- Skeleton loaders for structure
- Avoid layout shift (reserve space)
- Show progress for long operations

---

## Shell Script Security

```typescript
// ALWAYS escape user input
`install_pkg "${escapeShellString(app.name)}" "${pkg}"`

// Scripts start safe
set -euo pipefail

// No eval. Ever.
// No backticks for command substitution
```

### Error Messages
```bash
# Casual but informative
error "Run as regular user, not root."
warn "Update failed, continuing..."

# Not robotic
error "ERROR: Elevated privileges detected."  # ❌
```

---

## Naming

| Type | Pattern | Example |
|------|---------|---------|
| Boolean | `is`, `has`, `should`, `can` | `isAur`, `hasYay` |
| Handler | `handle` prefix | `handleClick` |
| Setter | `set` prefix | `setTheme` |
| Ref | `Ref` suffix | `inputRef` |

**Concise**: `isAur` not `isArchUserRepositoryPackage`

---

## CSS & Theming

### Variables
```css
--bg-primary, --bg-secondary, --bg-tertiary
--text-primary, --text-secondary, --text-muted
--accent, --border-primary
```

### Rules
- Use variables, never hardcode colors
- `transition-colors` not `transition-all`
- Mobile-first breakpoints: `sm:`, `md:`, `lg:`

---

## Responsive Design

### Touch Targets
- Minimum 44x44px for touch
- Adequate spacing between targets

### Breakpoints
```css
/* Mobile first */
.element { /* base mobile */ }
@media (min-width: 640px) { /* sm */ }
@media (min-width: 768px) { /* md */ }
@media (min-width: 1024px) { /* lg */ }
```

---

## Error Handling

```typescript
// User-facing: friendly
toast.error("Couldn't copy. Try again?")

// Console: detailed
console.error('Clipboard API failed:', error);

// Never swallow
try { ... } catch { }  // ❌
try { ... } catch (e) { console.error(e); }  // ✅
```

---

## Dependencies

### Before Adding
1. Can we do it in <20 lines ourselves?
2. What's the bundle size impact?
3. Is it maintained?
4. Do we need the whole package or just one function?

### Existing Stack
- `framer-motion` - animations
- `lucide-react` - icons
- `gsap` - complex animations (use sparingly)
- `clsx` + `tailwind-merge` - className utilities

---

## Adding New Features

### New App
1. Add to `data.ts` in correct category
2. Include all available distro targets
3. Add `unavailableReason` with helpful links
4. Test generated scripts

### New Distro
1. Add to `DistroId` type
2. Add to `distros` array
3. Create script generator in `lib/scripts/`
4. Update `generateInstallScript.ts`

### New Component
1. Create in appropriate directory
2. Add to barrel `index.ts`
3. Keep under 150 lines
4. Extract hooks if logic-heavy

---

## Git Commits

```bash
feat: add keyboard navigation
fix: prevent hydration mismatch
refactor: extract AUR logic to hook
style: adjust tooltip positioning
docs: update README shortcuts
chore: bump dependencies
```

---

## Debugging

### Console Patterns
```typescript
// Conditional logging
if (process.env.NODE_ENV === 'development') {
  console.log('Debug:', data);
}

// Structured logging
console.group('useLinuxInit');
console.log('distro:', distro);
console.log('selected:', selected.size);
console.groupEnd();
```

### React DevTools
- Check for unnecessary re-renders
- Verify memo is working
- Profile expensive components

---

## Anti-Patterns

| Don't | Do Instead |
|-------|------------|
| `any` type | Proper types or `unknown` |
| Prop drilling 5+ | Context or composition |
| `useEffect` for derived state | Compute during render |
| Giant switch | Object lookup |
| `// TODO: fix later` | Fix now or create issue |
| `transition-all` | `transition-colors` |
| Hardcoded colors | CSS variables |
| Store computed state | Derive it |

---

## Quick Reference

| ✅ Do | ❌ Don't |
|------|---------|
| `// brief comment` | `/** Long JSDoc */` |
| Early return | Nested ifs |
| `isAur` | `isArchUserRepositoryPackage` |
| Extract hooks | 500-line components |
| CSS variables | Hardcoded colors |
| `escapeShellString()` | String concatenation |
| Union types | Enums |
| Derive state | Store computed |
| `<button>` | `<div onClick>` |
| 44px touch targets | Tiny buttons |

---

## Philosophy

Code should feel like it was written by someone who:
- Uses Arch btw
- Has vim keybindings muscle memory
- Ships fast, iterates faster
- Writes for humans first

Not like enterprise software following a 200-page style guide.
